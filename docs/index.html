<!doctype html>
<html lang="ko" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MyLib</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" />
  <link rel="stylesheet" href="css/style.css?v=2.3.1" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="js/bridge.js"></script>
  <script src="js/api_client.js"></script>
  <script src="js/main.js"></script>
  <link rel="icon" href="data:,">
</head>
<body>
  <button class="sidebar-toggle" onclick="toggleSidebar()" title="Menu">
    <span class="toggle-icon">â˜°</span>
  </button>

  <div id="sidebar" class="sidebar">
<div class="sidebar-header">
  <div class="sidebar-logo">MyLib</div>
  <div class="sidebar-title-row">
    <span class="sidebar-title">Menu</span>
    <button class="sidebar-close" onclick="toggleSidebar()">Ã—</button>
  </div>
</div>

    <div class="sidebar-content">
      <div class="sidebar-item theme-toggle" onclick="toggleTheme()">
        <span class="item-text">Dark / Light</span>
        <span class="theme-indicator" id="themeIndicator">ğŸŒ™</span>
      </div>

      <div class="sidebar-divider"></div>

      <div class="sidebar-section">
        <div class="sidebar-item active" data-tab="all" onclick="switchTab('all')">All</div>
        <div class="sidebar-item" data-tab="Novel" onclick="switchTab('Novel')">Novel</div>
        <div class="sidebar-item" data-tab="Webtoon" onclick="switchTab('Webtoon')">Webtoon</div>
        <div class="sidebar-item" data-tab="Manga" onclick="switchTab('Manga')">Comic</div>
        <div class="sidebar-item" data-tab="Completed" onclick="switchTab('Completed')">Completed</div>
      </div>

      <div class="sidebar-divider"></div>

      <div class="sidebar-section">
        <div class="sidebar-item" onclick="toggleAdultFilter()">
          <span>Adult</span>
          <span class="toggle-switch" id="adultToggle"></span>
        </div>
        <div class="sidebar-item" onclick="showFavorites()">Favorites</div>
        <div class="sidebar-item" onclick="showCalendar()">Calendar</div>
        <div class="sidebar-item" onclick="showTags()">Tags</div>
      </div>

      <div class="sidebar-divider"></div>

      <!-- íƒœê·¸ ëª©ë¡ -->
      <div class="sidebar-section" id="tagSection" style="display:none;">
        <div class="sidebar-section-title">Tags</div>
        <div id="sidebarTagList" class="sidebar-tag-list"></div>
      </div>
      <div class="sidebar-divider" id="tagDivider" style="display:none;"></div>
      <div class="sidebar-section">
        <div class="sidebar-item" onclick="openIndexModal('quick')">
          ÏŸ Quick Update
        </div>
        <div class="sidebar-item" onclick="openIndexModal('full')">
          âŸ³ Full Rebuild
        </div>
        <div class="sidebar-item" onclick="dataSync()">
          â†» Data Sync
        </div>
        <div class="sidebar-item" onclick="logout()">
          â†’ Logout
        </div>
      </div>
    </div>
    <div class="sidebar-divider"></div>
      <div class="sidebar-section">
        <div class="sidebar-item accordion-header" onclick="toggleSettingsAccordion()">
          <span>Settings</span>
          <span class="accordion-icon" id="settingsIcon">â–¼</span>
        </div>
        <div class="accordion-content" id="settingsContent">
          <div class="settings-group">
            <div class="settings-label">ë·°ì–´ ì„¤ì •</div>
            <div class="checkbox-group">
              <label class="checkbox-label">
                <input type="checkbox" id="pref_2page" />
                <span>2ìª½ ë³´ê¸°</span>
              </label>
              <label class="checkbox-label">
                <input type="checkbox" id="pref_cover" />
                <span>í‘œì§€ ìš°ì„ </span>
              </label>
              <label class="checkbox-label">
                <input type="checkbox" id="pref_rtl" />
                <span>ì¼ë³¸ë§Œí™”(ìš°ì¢Œ)</span>
              </label>
            </div>
            <div style="display:none;">
              <input type="radio" name="view_engine" value="foliate" />
              <input type="radio" name="view_engine" value="legacy" checked />
            </div>
          </div>
          <button class="btn btn-save-settings" onclick="saveActiveSettings()">ì €ì¥</button>
        </div>
      </div>
    <div class="sidebar-version" id="viewerVersionDisplay">MyLib: Loading...</div>
  </div>

  <div id="sidebarOverlay" class="sidebar-overlay" onclick="toggleSidebar()"></div>

  <div class="app-container">
    <header>
      <div class="header-top">
        <h1 onclick="location.reload()">MyLib</h1>
      </div>
      <div class="header-controls">
        <div class="search-wrapper">
          <input type="text" id="search" class="search-box" placeholder="Search..." onkeyup="filterData()" />
        </div>
        <button class="btn-theme-header" onclick="toggleTheme()" title="Theme">
          <span class="theme-icon" id="headerThemeIcon">ğŸŒ™</span>
        </button>
      </div>
    </header>

    <main class="main-content">
      <div class="grid-container" id="grid"></div>
      <div class="calendar-page" id="calendarPage" style="display: none;"></div>
    </main>
  </div>
<!-- ===== CONFIG MODAL ===== -->
<div id="configModal" class="modal-overlay">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">MyLib Setting</div>
    </div>
    <div class="modal-body">
      <!-- ë¹„ë°€ë²ˆí˜¸ (í•­ìƒ ë³´ì„) -->
      <div class="config-group">
        <label class="config-label">Password(API_PASSWORD)</label>
        <input type="password" id="configApiPassword" class="config-input" placeholder="ë¹„ë°€ë²ˆí˜¸" />
      </div>

      <!-- ìƒì„¸ ì„¤ì • í† ê¸€ -->
     <div class="config-toggle" id="configToggle" onclick="toggleConfigDetails()">
       Advanced Settings
      </div>

      <!-- ìƒì„¸ ì„¤ì • (ì ‘í˜) -->
      <div class="config-details" id="configDetails">
        <div class="config-group">
          <label class="config-label">GAS URL</label>
          <input type="text" id="configApiUrl" class="config-input" placeholder="ë°°í¬ URL ë¶™ì—¬ë„£ê¸°" />
        </div>
        <div class="config-group">
          <label class="config-label">Root Folder ID</label>
          <input type="text" id="configFolderId" class="config-input" placeholder="Drive í´ë” ID" />
        </div>
        <div class="config-group">
          <label class="config-label">ID(API_ID)</label>
          <input type="text" id="configApiId" class="config-input" placeholder="API ID" />
        </div>
        <div class="config-group">
          <label class="config-label">Notify LOG Email</label>
          <input type="email" id="configNotifyEmail" class="config-input" placeholder="example@gmail.com" />
        </div>
      </div>

      <button class="btn btn-save" onclick="saveManualConfig()">Login</button>
    </div>
  </div>
</div>
  <!-- ===== DETAIL MODAL ===== -->
  <div id="detailModal" class="modal-overlay">
    <div class="modal detail-modal">
<div class="modal-header">
  <div class="modal-title-wrapper">
    <div class="modal-title" id="detailTitle">ì‘í’ˆ ì œëª©</div>
      <span class="adult-badge" id="detailAdultBadge" style="display:none;">ğŸ”</span>
  </div>
  <div class="modal-header-actions">
    <button class="btn-favorite" onclick="toggleFavorite()" title="ì¦ê²¨ì°¾ê¸°">
      <span id="favoriteIcon">â™¡</span>
    </button>
    <button class="btn-header-edit" id="btnMoveCompleted" onclick="moveToCompleted()">Move</button>
    <button class="btn-header-edit" onclick="openEditFromDetail()">Edit</button>
    <button class="modal-close" onclick="closeDetailModal()">Ã—</button>
  </div>
</div>
      <div class="modal-body">
        <!-- ì»¤ë²„ -->
        <div class="detail-cover-wrapper" onclick="toggleDetailEpisodes()">
          <img id="detailCover" class="detail-cover" src="" alt="cover">
          <div class="detail-cover-no-image" id="detailCoverNoImage">No Image</div>
          <div class="cover-hint">í´ë¦­í•˜ì—¬ íšŒì°¨ ë³´ê¸°</div>
        </div>

        <!-- íƒœê·¸ (ì œëª© ë°‘) -->
        <div class="detail-tags" id="detailTags"></div>

        <!-- íšŒì°¨ ëª©ë¡ -->
        <div class="detail-episodes" id="detailEpisodes" style="display:none;">
          <div class="episode-header">
            <a id="detailDriveLink" href="#" target="_blank">Open in Drive â†—</a>
            <button class="btn-refresh-episodes" onclick="refreshDetailEpisodes()">Refresh</button>
          </div>
          <div class="episode-list-wrapper">
            <div id="detailEpisodeList"></div>
          </div>
        </div>

        <!-- ì‘í’ˆ ì •ë³´ -->
<!-- ì‘í’ˆ ì •ë³´ -->
<div class="detail-info">
  <div class="info-row">
    <span class="info-label">ì œëª©</span>
    <span class="info-value" id="detailInfoTitle">-</span>
  </div>
  <div class="info-row">
    <span class="info-label">ì‘ê°€</span>
    <span class="info-value" id="detailInfoAuthor">-</span>
  </div>
  <div class="info-row">
    <span class="info-label">ìƒíƒœ</span>
    <span class="info-value" id="detailInfoStatus">-</span>
  </div>
  <div class="info-row clickable" onclick="openPlatformSite()">
    <span class="info-label">í”Œë«í¼</span>
    <span class="info-value info-link" id="detailInfoPlatform">-</span>
  </div>
</div>
<!-- ì‘í’ˆ ì†Œê°œ (í† ê¸€) -->
<div class="description-wrapper" id="descWrapper">
  <div class="description-label">ì‘í’ˆ ì†Œê°œ</div>
  <div class="description-content" id="detailInfoDescription">
    ì†Œê°œ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.
  </div>
  <button class="desc-toggle-btn" id="descToggleBtn" onclick="toggleDescription()"></button>
</div>
      </div>
    </div>
  </div>
    <!-- ===== EDIT MODAL ===== -->
  <div id="editModal" class="modal-overlay">
    <div class="modal edit-modal">
      <div class="modal-header">
        <div class="modal-title">Edit</div>
        <button class="modal-close" onclick="closeEditModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <!-- ì»¤ë²„ ì´ë¯¸ì§€ -->
        <div class="edit-cover-section">
          <div class="edit-cover-preview">
            <img id="editCoverPreview" src="" alt="ì»¤ë²„">
            <div class="edit-cover-no-image" id="editCoverNoImage">No Image</div>
          </div>
          <div class="edit-cover-actions">
            <label class="btn btn-upload" for="editCoverFile">ì»¤ë²„ ì—…ë¡œë“œ</label>
            <input type="file" id="editCoverFile" accept="image/*" style="display:none" onchange="handleCoverSelect(event)">
            <div class="edit-cover-filename" id="editCoverFilename"></div>
          </div>
        </div>

        <!-- í¸ì§‘ í¼ -->
        <div class="edit-form">
          <!-- ì œëª© + ì„±ì¸ì‘í’ˆ ì²´í¬ (ê°™ì€ ì¤„) -->
<div class="edit-field">
  <div class="edit-field-header">
    <label>ì œëª©</label>
    <label class="checkbox-label-adult">
      <span>ğŸ” ì„±ì¸ì‘í’ˆ</span>
      <input type="checkbox" id="editAdult">
    </label>
  </div>
  <input type="text" id="editTitle" placeholder="ì‘í’ˆ ì œëª©">
</div>
          <div class="edit-field">
            <label>ì‘ê°€</label>
            <input type="text" id="editAuthor" placeholder="ì‘ê°€ëª… (ì—¬ëŸ¬ëª…: ì‰¼í‘œ êµ¬ë¶„)">
          </div>
          <div class="edit-field">
            <label>ì—°ì¬ìƒíƒœ</label>
            <select id="editStatus">
              <option value="Unknown">ì•Œìˆ˜ì—†ìŒ</option>
              <option value="ì—°ì¬ì¤‘">ì—°ì¬ì¤‘</option>
              <option value="ì™„ê²°">ì™„ê²°</option>
              <option value="íœ´ì¬">íœ´ì¬</option>
            </select>
          </div>
          <div class="edit-field">
            <label>í”Œë«í¼</label>
            <select id="editPublisher">
              <option value="">ë¯¸ì§€ì •</option>
              <option value="ë„¤ì´ë²„">ë„¤ì´ë²„</option>
              <option value="ì¹´ì¹´ì˜¤">ì¹´ì¹´ì˜¤</option>
              <option value="ë¬¸í”¼ì•„">ë¬¸í”¼ì•„</option>
              <option value="ì¡°ì•„ë¼">ì¡°ì•„ë¼</option>
              <option value="ë¦¬ë””">ë¦¬ë””</option>
              <option value="ë…¸ë²¨í”¼ì•„">ë…¸ë²¨í”¼ì•„</option>
              <option value="ë ˆì§„ì½”ë¯¹ìŠ¤">ë ˆì§„ì½”ë¯¹ìŠ¤</option>
              <option value="íƒ‘íˆ°">íƒ‘íˆ°</option>
              <option value="ë´„íˆ°">ë´„íˆ°</option>
              <option value="ì¼ë³¸ë§Œí™”">ì¼ë³¸ë§Œí™”</option>
              <option value="ê¸°íƒ€í”Œë«í¼">ê¸°íƒ€í”Œë«í¼</option>
            </select>
          </div>
          <div class="edit-field">
            <label>í”Œë«í¼ ë§í¬</label>
            <input type="text" id="editPlatformUrl" placeholder="https://...">
          </div>
          <div class="edit-field">
            <label>ì‘í’ˆ ì†Œê°œ</label>
            <textarea id="editDescription" placeholder="ì‘í’ˆ ì†Œê°œë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
          </div>
          <div class="edit-field">
            <label>íƒœê·¸</label>
            <div class="edit-tags-container" id="editTagsContainer"></div>
            <div class="edit-tags-select" id="editTagsSelect"></div>
          </div>
        </div>

        <!-- ìˆ¨ê¹€ í•„ë“œ -->
        <input type="hidden" id="editSourceId">
        <input type="hidden" id="editUrl">
        <input type="hidden" id="editCategory">

        <!-- ë²„íŠ¼ -->
        <div class="edit-buttons">
          <button class="btn edit-btn-cancel" onclick="closeEditModal()">ì·¨ì†Œ</button>
          <button class="btn edit-btn-save" onclick="saveEditInfo()">ì €ì¥</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== EPISODE MODAL ===== -->
  <div id="episodeModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">íšŒì°¨ ëª©ë¡</div>
        <button class="modal-close" onclick="closeEpisodeModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <div id="episodeList" class="episode-list"></div>
      </div>
    </div>
  </div>

  <!-- ===== TAGS MODAL ===== -->
  <div id="tagsModal" class="modal-overlay">
    <div class="modal tags-modal">
      <div class="modal-header">
        <div class="modal-title">íƒœê·¸ ê´€ë¦¬</div>
        <button class="modal-close" onclick="closeTagsModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <div class="tags-create">
          <input type="text" class="config-input" id="newTagInput" placeholder="ìƒˆ íƒœê·¸ ì´ë¦„ (ì˜ˆ: íŒíƒ€ì§€)">
          <button class="btn btn-add-tag" onclick="createTag()">ì¶”ê°€</button>
        </div>
        <div class="tags-list" id="tagsList"></div>
      </div>
    </div>
  </div>
<!-- ===== CALENDAR MODAL ===== -->
<div id="calendarModal" class="modal-overlay">
  <div class="modal calendar-modal">
    <div class="modal-header">
      <div class="modal-title">Calendar</div>
      <button class="modal-close" onclick="closeCalendarModal()">Ã—</button>
    </div>
    <div class="modal-body">
      <!-- ë‹¬ë ¥ -->
      <div class="calendar-wrapper">
        <div class="calendar-header">
          <button class="cal-nav" onclick="changeMonth(-1)">â—€</button>
          <span class="cal-title" id="calendarTitle">2025ë…„ 1ì›”</span>
          <button class="cal-nav" onclick="changeMonth(1)">â–¶</button>
        </div>
        <div class="calendar-grid" id="calendarGrid"></div>
      </div>
<!-- Add Record ë²„íŠ¼ ì¶”ê°€ -->
<button class="btn-add-record" onclick="openRecordModal()">+ Add Record</button>
      <!-- í†µê³„ -->
      <div class="calendar-stats">
        <div class="stat-row">
          <div class="stat-item-sm stat-clickable" onclick="showRecordsByStatus('completed')">
            <span class="stat-label">Completed</span>
            <span class="stat-value" id="statCompleted">0</span>
          </div>
          <div class="stat-item-sm stat-clickable" onclick="showRecordsByStatus('dropped')">
            <span class="stat-label">Dropped</span>
            <span class="stat-value" id="statDropped">0</span>
          </div>
          <div class="stat-item-sm stat-clickable" onclick="showRecordsByStatus('reading')">
            <span class="stat-label">Reading</span>
            <span class="stat-value" id="statReading">0</span>
          </div>
        </div>
        <div class="stat-row">
          <div class="stat-item-sm">
            <span class="stat-label">Read</span>
            <span class="stat-value" id="statRead">0</span>
          </div>
          <div class="stat-item-sm">
            <span class="stat-label">Remaining</span>
            <span class="stat-value" id="statRemaining">0</span>
          </div>
          <div class="stat-item-sm">
            <span class="stat-label">Total</span>
            <span class="stat-value" id="statTotal">0</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ===== MINI BOOKSHELF MODAL ===== -->
<div id="bookshelfModal" class="modal-overlay">
  <div class="modal bookshelf-modal">
    <div class="modal-header">
      <div class="modal-title" id="bookshelfTitle">Completed (0)</div>
      <button class="modal-close" onclick="closeBookshelfModal()">Ã—</button>
    </div>
    <div class="modal-body">
      <div class="bookshelf-grid" id="bookshelfGrid"></div>
    </div>
  </div>
</div>

<!-- ===== BOOK RECORDS MODAL ===== -->
<div id="bookRecordsModal" class="modal-overlay">
  <div class="modal book-records-modal">
    <div class="modal-header">
      <div class="modal-title" id="bookRecordsTitle">Book Records</div>
      <button class="modal-close" onclick="closeBookRecordsModal()">Ã—</button>
    </div>
    <div class="modal-body">
      <div class="book-records-header" id="bookRecordsHeader"></div>
      <div class="book-records-list" id="bookRecordsList"></div>
    </div>
  </div>
</div>
<!-- ===== RESTORE MODAL ===== -->
<div id="restoreModal" class="modal-overlay">
  <div class="modal" style="max-width: 320px;">
    <div class="modal-header">
      <div class="modal-title">Restore to</div>
      <button class="modal-close" onclick="closeRestoreModal()">Ã—</button>
    </div>
    <div class="modal-body">
      <div class="restore-options">
        <div class="sidebar-item" onclick="restoreToCategory('Novel')">Novel</div>
        <div class="sidebar-item" onclick="restoreToCategory('Webtoon')">Webtoon</div>
        <div class="sidebar-item" onclick="restoreToCategory('Manga')">Manga</div>
      </div>
    </div>
  </div>
</div>
<!-- ===== RECORD MODAL ===== -->
<div id="recordModal" class="modal-overlay">
  <div class="modal record-modal">
    <div class="modal-header">
      <div class="modal-title" id="recordModalTitle">Add Record</div>
      <button class="modal-close" onclick="closeRecordModal()">Ã—</button>
    </div>
    <div class="modal-body">
      <!-- ì±… ê²€ìƒ‰/ì„ íƒ -->
      <div class="record-field">
        <label>Book</label>
        <input type="text" id="recordBookSearch" class="config-input" placeholder="Search book..." oninput="searchBooks(this.value)">
        <div class="record-book-results" id="recordBookResults"></div>
        <input type="hidden" id="recordBookId">
      </div>

      <!-- ì„ íƒëœ ì±… (ì»¤ë²„ í¬í•¨) -->
      <div class="record-selected-book" id="recordSelectedBook" style="display:none;">
        <div class="record-selected-cover" id="recordSelectedCover"></div>
        <div class="record-selected-name" id="recordSelectedName"></div>
      </div>

      <!-- ì§„í–‰ë¥  -->
      <div class="record-field">
        <label>Progress: <span id="recordProgressValue">0</span>%</label>
        <input type="range" id="recordProgress" min="0" max="100" value="0" oninput="updateProgressValue(this.value)">
      </div>

      <!-- ìƒíƒœ -->
      <div class="record-field">
        <label>Status</label>
        <div class="record-status-options">
          <label class="record-status-option">
            <input type="radio" name="recordStatus" value="reading" checked>
            <span>Reading</span>
          </label>
          <label class="record-status-option">
            <input type="radio" name="recordStatus" value="completed">
            <span>Completed</span>
          </label>
          <label class="record-status-option">
            <input type="radio" name="recordStatus" value="dropped">
            <span>Dropped</span>
          </label>
        </div>
      </div>

      <!-- ë©”ëª¨ -->
      <div class="record-field">
        <label>Memo</label>
        <div class="record-memos-container" id="recordMemosContainer">
          <div class="record-memo-row">
            <textarea class="config-input record-memo-input" placeholder="Add memo..." rows="3"></textarea>
          </div>
        </div>
        <button class="btn-add-memo" onclick="addMemoField()">+ Add Memo</button>
      </div>

      <!-- ë²„íŠ¼ -->
      <div class="record-buttons">
        <button class="btn" onclick="closeRecordModal()" style="background: var(--bg-input);">Cancel</button>
        <button class="btn" onclick="saveRecord()" style="background: var(--accent); color: white;">Save</button>
      </div>
    </div>
  </div>
</div>
<!-- ===== INDEX UPDATE MODAL ===== -->
<div id="indexModal" class="modal-overlay">
  <div class="modal index-modal">
    <div class="modal-header">
      <div class="modal-title">Index Update</div>
      <button class="modal-close" onclick="closeIndexModal()">Ã—</button>
    </div>
    <div class="modal-body">
      <!-- Status -->
      <div class="index-status">
        <span id="indexStatusBadge" class="index-status-badge idle">Idle</span>
        <span id="indexModeLabel" class="index-mode-label"></span>
      </div>

      <!-- Stats -->
      <div class="index-stats">
        <div class="index-stat-item">
          <div class="index-stat-value" id="indexProcessed">0</div>
          <div class="index-stat-label">Processed</div>
        </div>
        <div class="index-stat-item">
          <div class="index-stat-value" id="indexTotal">0</div>
          <div class="index-stat-label">Total</div>
        </div>
        <div class="index-stat-item">
          <div class="index-stat-value" id="indexMissing">0</div>
          <div class="index-stat-label">NoCover</div>
        </div>
      </div>

      <!-- Progress -->
      <div class="index-progress" id="indexProgressSection" style="display:none;">
        <div class="index-progress-header">
          <span id="indexProgressText">0%</span>
          <span id="indexProgressDetail">0 / 0</span>
        </div>
        <div class="index-progress-bar-bg">
          <div class="index-progress-bar-fill" id="indexProgressBar" style="width:0%"></div>
        </div>
      </div>

      <!-- Categories -->
      <div class="index-categories" id="indexCategories"></div>

      <!-- Log -->
      <div class="index-log-header">
        <label>
          <input type="checkbox" id="indexAutoScroll" checked />
          Auto Scroll
        </label>
        <span class="index-log-count" id="indexLogCount">0 lines</span>
      </div>
      <div class="index-log-container" id="indexLogContainer">
        <div class="index-log-entry">
          <span class="index-log-time">--:--:--</span>
          <span class="index-log-msg">Waiting...</span>
        </div>
      </div>

      <!-- Buttons -->
      <div class="index-buttons">
        <button class="btn index-btn" id="indexBtnFull" onclick="startIndexUpdate('full')">
          Full Rebuild
        </button>
        <button class="btn index-btn" id="indexBtnQuick" onclick="startIndexUpdate('quick')">
          Quick Update
        </button>
        <button class="btn index-btn" id="indexBtnPause" onclick="pauseIndexUpdate()" disabled>
          Pause
        </button>
        <button class="btn index-btn index-btn-close" onclick="closeIndexModal()">
          Close
        </button>
      </div>
    </div>
  </div>
</div>
    <!-- ===== VIEWER OVERLAY ===== -->
  <div id="viewerOverlay" class="viewer-overlay">
    <div class="viewer-content" id="viewerContent" onclick="handleViewerClick(event)">
      <div class="nav-zone nav-prev"></div>
      <div class="nav-zone nav-next"></div>
      <div id="viewerImageContainer" class="viewer-image-container"></div>
      <div id="viewerScrollContainer" class="viewer-scroll-container" style="display: none"></div>
      <div id="pageCounter" class="page-counter">- / -</div>
    </div>

    <div id="viewerControls" class="viewer-controls">
      <div class="viewer-header">
        <span class="viewer-title" id="viewerTitle">TokiViewer</span>
        <button class="btn-icon close-btn" onclick="closeViewer()">Ã—</button>
      </div>

      <div class="viewer-footer">
        <div class="footer-row main-row">
          <button class="btn-icon" onclick="openEpisodeListFromViewer()" title="ëª©ì°¨">ğŸ“‘</button>

          <div class="slider-container">
            <span id="sliderCurrent" class="slider-label">1</span>
            <input type="range" id="pageSlider" min="1" max="100" value="1" step="1" oninput="onSliderInput(this.value)" onchange="onSliderChange(this.value)" />
            <span id="sliderTotal" class="slider-label">100</span>
          </div>

          <div class="nav-buttons">
            <button class="btn-icon" onclick="navigateViewer(-1)">â—€</button>
            <button class="btn-icon" onclick="navigateViewer(1)">â–¶</button>
          </div>
        </div>

        <div class="footer-row settings-row">
          <button id="btnTwoPage" class="btn-toggle image-only" onclick="toggleViewMode()">2ìª½ ë³´ê¸°</button>
          <button id="btnCover" class="btn-toggle image-only" onclick="toggleCoverMode()">í‘œì§€ ë¨¼ì €</button>
          <button id="btnScroll" class="btn-toggle" onclick="toggleScrollMode()">ìŠ¤í¬ë¡¤ ë³´ê¸°</button>
          <button id="btnRtl" class="btn-toggle image-only" onclick="toggleRtlMode()">ì¼ë³¸ì–´(ìš°ì¢Œ)</button>

          <button class="btn-toggle epub-only" onclick="changeFontSize(-2)">ê¸€ì -</button>
          <button class="btn-toggle epub-only" onclick="changeFontSize(2)">ê¸€ì +</button>

          <div class="divider"></div>
          <button id="btnPreload" class="btn-toggle" onclick="togglePreloadMode()">ë¯¸ë¦¬ ë¡œë”©</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== PAGE LOADER ===== -->
  <div id="pageLoader" class="loader-overlay" style="display:none;">
    <div class="spinner"></div>
    <div class="loader-text">ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
  </div>

  <script type="module" src="js/include.js?v=3.3.4"></script>
</body>
</html>
